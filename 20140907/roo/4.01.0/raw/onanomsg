++ opam install onanomsg -e ubuntu
+ depext='libffi-dev pkg-config'
+ echo Ubuntu depexts: libffi-dev pkg-config
+ '[' 'libffi-dev pkg-config' '!=' '' ']'
+ sudo apt-get install -qq -y build-essential m4
Ubuntu depexts: libffi-dev pkg-config
+ sudo apt-get install -qq -y libffi-dev pkg-config
debconf: unable to initialize frontend: Dialog
debconf: (Dialog frontend will not work on a dumb terminal, an emacs shell buffer, or without a controlling terminal.)
debconf: falling back to frontend: Readline
debconf: unable to initialize frontend: Readline
debconf: (This frontend requires a controlling tty.)
debconf: falling back to frontend: Teletype
dpkg-preconfigure: unable to re-open stdin: 
Selecting previously unselected package libffi-dev:amd64.
(Reading database ... 20147 files and directories currently installed.)
Preparing to unpack .../libffi-dev_3.1~rc1+r3.0.13-12_amd64.deb ...
Unpacking libffi-dev:amd64 (3.1~rc1+r3.0.13-12) ...
Setting up libffi-dev:amd64 (3.1~rc1+r3.0.13-12) ...
++ opam install onanomsg -e source,linux
Ubuntu srcexts: https://gist.githubusercontent.com/avsm/ce2ce785f27c9349d99d/raw
+ srcext=https://gist.githubusercontent.com/avsm/ce2ce785f27c9349d99d/raw
+ echo Ubuntu srcexts: https://gist.githubusercontent.com/avsm/ce2ce785f27c9349d99d/raw
+ '[' https://gist.githubusercontent.com/avsm/ce2ce785f27c9349d99d/raw '!=' '' ']'
++ mktemp
+ t=/tmp/tmp.j3DcMETbsg
+ curl -sL https://gist.githubusercontent.com/avsm/ce2ce785f27c9349d99d/raw
+ bash -ex /tmp/tmp.j3DcMETbsg
+ opam install onanomsg
The following actions will be performed:
 - install   conf-nanomsg.0                        [required by onanomsg]
 - install   camlp4.4.01.0                         [required by ocp-build]
 - install   base-bytes.legacy                     [required by ctypes]
 - install   ocp-build.1.99.8-beta                 [required by onanomsg]
 - install   ctypes.0.3.3                          [required by onanomsg]
 - install   onanomsg.0.1
=== 6 to install ===

=-=- Synchronizing package archives -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
[default] Synchronizing with /home/opam/opam-repository/archives/ctypes.0.3.3+opam.tar.gz
[default] Synchronizing with /home/opam/opam-repository/archives/ocp-build.1.99.8-beta+opam.tar.gz
[default] Synchronizing with /home/opam/opam-repository/archives/onanomsg.0.1+opam.tar.gz
sending incremental file list
sending incremental file list
onanomsg.0.1+opam.tar.gz
sending incremental file list
ocp-build.1.99.8-beta+opam.tar.gz
ctypes.0.3.3+opam.tar.gz

sent 8,336 bytes  received 35 bytes  16,742.00 bytes/sec
total size is 8,203  speedup is 0.98

sent 132,062 bytes  received 35 bytes  264,194.00 bytes/sec
total size is 131,901  speedup is 1.00

sent 899,755 bytes  received 35 bytes  1,799,580.00 bytes/sec
total size is 899,401  speedup is 1.00

=-=- Installing packages =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
Installing base-bytes.legacy.
Installing camlp4.4.01.0.
Building conf-nanomsg.0:
  pkg-config libnanomsg
[ERROR] The compilation of conf-nanomsg.0 failed.
Removing conf-nanomsg.0.
  Nothing to do.
Building ctypes.0.3.3:
  make
  make install
ocaml src/discover/discover.ml -ocamlc "ocamlfind ocamlc"
testing for brew: .............................. unavailable
testing for pkg-config: ........................ available
testing for libffi: ............................ available
testing for no_as_needed: ...................... available
ocamlfind opt -c -o _build/src/configure/make_primitive_details.cmx        -I _build/src/configure  src/configure/make_primitive_details.ml
cd _build/src/configure && ocamlfind ocamlc -c -ccopt -fPIC -ccopt -Wall -ccopt -O3 -ccopt -I -ccopt /home/opam/opam-repository/src -ccopt -I -ccopt /home/opam/opam-repository/tests -o make_primitive_details_stubs.o  /home/opam/.opam/4.01.0/build/ctypes.0.3.3/src/configure/make_primitive_details_stubs.c
ocamlfind opt -I _build -linkpkg      -o _build/configure.native _build/src/configure/make_primitive_details.cmx _build/src/configure/make_primitive_details_stubs.o  
ocamlfind opt -c -o _build/src/libffi-abigen/libffi_abigen.cmx -package unix    -package unix   -I _build/src/libffi-abigen  src/libffi-abigen/libffi_abigen.ml
ocamlfind opt -I _build -linkpkg   -package unix   -o _build/libffi-abigen.native _build/src/libffi-abigen/libffi_abigen.cmx  
_build/configure.native > src/ctypes/ctypes_primitives.ml
_build/libffi-abigen.native > src/ctypes-foreign-base/libffi_abi.ml
